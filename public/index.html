<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product-GPT App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .product-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s;
        }
        .product-card:hover {
            transform: translateY(-2px);
        }
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background-color: #f0f0f0;
        }
        .product-info {
            padding: 15px;
        }
        .product-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        .product-price {
            font-size: 16px;
            color: #007cba;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .product-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .status-active {
            background-color: #d4edda;
            color: #155724;
        }
        .status-draft {
            background-color: #fff3cd;
            color: #856404;
        }
        .button {
            background-color: #007cba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        .button:hover {
            background-color: #005a87;
        }
        .button-secondary {
            background-color: #6c757d;
        }
        .button-secondary:hover {
            background-color: #545b62;
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #666;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover {
            color: #000;
        }
        .config-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Product-GPT App</h1>
        <p>Display your Shopify store products and integrate with ChatGPT</p>
        <button class="button" onclick="openChatGpt()">Connect ChatGPT</button>
        <button class="button button-secondary" onclick="showConfig()">Configure Store</button>
    </div>

    <!-- Configuration Section -->
    <div id="configSection" class="config-section" style="display: none;">
        <h3>Configure Your Shopify Store</h3>
        <div class="input-group">
            <label for="shopDomain">Shop Domain (e.g., your-store.myshopify.com):</label>
            <input type="text" id="shopDomain" placeholder="your-store.myshopify.com">
        </div>
        <div class="input-group">
            <label for="accessToken">Storefront Access Token:</label>
            <input type="password" id="accessToken" placeholder="Enter your Storefront access token">
        </div>
        <button class="button" onclick="saveConfig()">Save Configuration</button>
        <button class="button button-secondary" onclick="hideConfig()">Cancel</button>
        <p><small>To get your Storefront access token: Go to Shopify Admin → Settings → Apps and sales channels → Develop apps → Create an app → Configure Storefront API → Install app → Copy the access token</small></p>
    </div>

    <!-- Products Section -->
    <div id="productsSection">
        <div id="loading" class="loading">Loading products...</div>
        <div id="error" class="error" style="display: none;"></div>
        <div id="productsGrid" class="products-grid"></div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        let products = [];
        let config = JSON.parse(localStorage.getItem('shopifyConfig') || '{}');

        // Load configuration on page load
        if (config.shopDomain && config.accessToken) {
            loadProducts();
        } else {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('configSection').style.display = 'block';
        }

        function showConfig() {
            document.getElementById('configSection').style.display = 'block';
            if (config.shopDomain) {
                document.getElementById('shopDomain').value = config.shopDomain;
            }
            if (config.accessToken) {
                document.getElementById('accessToken').value = config.accessToken;
            }
        }

        function hideConfig() {
            document.getElementById('configSection').style.display = 'none';
        }

        function saveConfig() {
            const shopDomain = document.getElementById('shopDomain').value.trim();
            const accessToken = document.getElementById('accessToken').value.trim();
            
            if (!shopDomain || !accessToken) {
                alert('Please enter both shop domain and access token');
                return;
            }

            config = { shopDomain, accessToken };
            localStorage.setItem('shopifyConfig', JSON.stringify(config));
            hideConfig();
            loadProducts();
        }

        async function loadProducts() {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const productsGrid = document.getElementById('productsGrid');

            loading.style.display = 'block';
            error.style.display = 'none';
            productsGrid.innerHTML = '';

            try {
                const query = `
                    query {
                        products(first: 20) {
                            edges {
                                node {
                                    id
                                    title
                                    handle
                                    description
                                    status
                                    images(first: 1) {
                                        edges {
                                            node {
                                                url
                                                altText
                                            }
                                        }
                                    }
                                    variants(first: 10) {
                                        edges {
                                            node {
                                                id
                                                title
                                                price {
                                                    amount
                                                    currencyCode
                                                }
                                                availableForSale
                                            }
                                        }
                                    }
                                    tags
                                    productType
                                    vendor
                                }
                            }
                        }
                    }
                `;

                const response = await fetch(`https://${config.shopDomain}/api/2023-10/graphql.json`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Shopify-Storefront-Access-Token': config.accessToken
                    },
                    body: JSON.stringify({ query })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.errors) {
                    throw new Error(data.errors[0].message);
                }

                products = data.data.products.edges;
                displayProducts();
                loading.style.display = 'none';

            } catch (err) {
                console.error('Error loading products:', err);
                loading.style.display = 'none';
                error.style.display = 'block';
                error.textContent = `Error loading products: ${err.message}. Please check your configuration.`;
            }
        }

        function displayProducts() {
            const productsGrid = document.getElementById('productsGrid');
            productsGrid.innerHTML = '';

            if (products.length === 0) {
                productsGrid.innerHTML = '<div class="loading">No products found</div>';
                return;
            }

            products.forEach(({ node: product }) => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                const imageUrl = product.images.edges.length > 0 
                    ? product.images.edges[0].node.url 
                    : 'https://via.placeholder.com/300x200?text=No+Image';
                
                const price = product.variants.edges.length > 0 
                    ? formatPrice(product.variants.edges[0].node.price)
                    : 'Price not available';

                productCard.innerHTML = `
                    <img src="${imageUrl}" alt="${product.title}" class="product-image">
                    <div class="product-info">
                        <div class="product-title">${product.title}</div>
                        <div class="product-price">${price}</div>
                        <span class="product-status status-${product.status.toLowerCase()}">${product.status}</span>
                        <br>
                        <button class="button" onclick="showProductDetails('${product.id}')">View Details</button>
                    </div>
                `;
                
                productsGrid.appendChild(productCard);
            });
        }

        function showProductDetails(productId) {
            const product = products.find(p => p.node.id === productId)?.node;
            if (!product) return;

            const modal = document.getElementById('productModal');
            const modalContent = document.getElementById('modalContent');
            
            const imageUrl = product.images.edges.length > 0 
                ? product.images.edges[0].node.url 
                : 'https://via.placeholder.com/400x300?text=No+Image';

            const variants = product.variants.edges.map(({ node: variant }) => `
                <div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 4px;">
                    <strong>${variant.title}</strong><br>
                    Price: ${formatPrice(variant.price)}<br>
                    Available: ${variant.availableForSale ? 'Yes' : 'No'}
                </div>
            `).join('');

            modalContent.innerHTML = `
                <h2>${product.title}</h2>
                <img src="${imageUrl}" alt="${product.title}" style="width: 100%; max-width: 400px; height: auto; margin: 10px 0;">
                <p><strong>Status:</strong> ${product.status}</p>
                ${product.vendor ? `<p><strong>Vendor:</strong> ${product.vendor}</p>` : ''}
                ${product.productType ? `<p><strong>Type:</strong> ${product.productType}</p>` : ''}
                ${product.tags.length > 0 ? `<p><strong>Tags:</strong> ${product.tags.join(', ')}</p>` : ''}
                ${product.description ? `<p><strong>Description:</strong> ${product.description}</p>` : ''}
                <h3>Variants:</h3>
                ${variants}
            `;
            
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: price.currencyCode
            }).format(price.amount);
        }

        function openChatGpt() {
            window.open('https://chat.openai.com/auth/login', '_blank', 'width=800,height=600');
            alert('ChatGPT login window opened! Please login there.');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('productModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html> 